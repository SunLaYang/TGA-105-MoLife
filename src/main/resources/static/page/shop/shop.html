<!DOCTYPE html>
<html lang="en">
  <head>
    <title>MoLife | 商品專區</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="Colo Shop Template" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      rel="stylesheet"
      type="text/css"
      href="../../styles/bootstrap4/bootstrap.min.css" />
    <link
      href="../../plugins/font-awesome-4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
      type="text/css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../plugins/OwlCarousel2-2.2.1/owl.carousel.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../plugins/OwlCarousel2-2.2.1/owl.theme.default.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../plugins/OwlCarousel2-2.2.1/animate.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../plugins/jquery-ui-1.12.1.custom/jquery-ui.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../styles/categories_styles.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../../styles/categories_responsive.css" />

    <link rel="stylesheet" href="../../styles/room/room.css" />

    <script
      src="https://kit.fontawesome.com/2672c0b72c.js"
      crossorigin="anonymous"></script>
    <style>
      .image-container {
        height: 220px;
        overflow: hidden; /* 隱藏溢出的內容 */
      }

      .image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* 填充剪裁適應容器 */
      }
    </style>
  </head>

  <body>
    <div class="super_container">
      <!-- Header -->
      <header class="header trans_300">
        <!-- Main Navigation -->
        <div class="main_nav_container bg-yellow">
          <div>
            <div class="row">
              <div class="col-lg-12 text-right">
                <div class="logo_container">
                  <a href="/page/others/24front_page.html">
                    <img src="../../images/home/logoMoLife.png" />
                  </a>
                </div>
                <nav class="navbar">
                  <ul class="navbar_menu">
                    <li><a href="/page/room/01room.index.html">寵物旅館</a></li>
                    <li><a href="/page/shop/shop.html">商品專區</a></li>
                    <li><a href="/pages/donate/N_1_index">寵物募款</a></li>
                    <li>
                      <a href="/page/others/24forum.index.html">寵物論壇</a>
                    </li>
                    <li><a href="/page/others/24contact.html">聯絡我們</a></li>
                  </ul>
                  <ul class="navbar_user">
                    <a href="/page/shop/shop-cart.html"
                      ><img class="icon" src="../../images/home/car.png"
                    /></a>
                    <a href="/page/others/24post_info.html"
                      ><img class="icon" src="../../images/home/ring.png"
                    /></a>
                    <a href="/pages/member/listOneMem.jsp"
                      ><img class="icon" src="../../images/home/man.png"
                    /></a>
                  </ul>
                  <div class="hamburger_container">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                  </div>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div class="container product_section_container">
        <div class="row">
          <div class="col product_section clearfix">
            <!-- Breadcrumbs -->

            <div class="breadcrumbs d-flex flex-row align-items-center">
              <ul>
                <li><a href="/page/others/24front_page.html">首頁</a></li>
                <li class="active">
                  <a href="/page/shop/shop.html"
                    ><i class="fa fa-angle-right" aria-hidden="true"></i
                    >商品專區</a
                  >
                </li>
              </ul>
            </div>

            <!-- 商品分類 -->

            <div class="sidebar">
              <div class="sidebar_section">
                <div class="sidebar_title">
                  <h5>商品分類</h5>
                </div>
                <ul class="sidebar_categories">
                  <li class="active">
                    <a href="shop.html"
                      ><span
                        ><i
                          class="fa fa-angle-double-right"
                          aria-hidden="true"></i></span
                      >全部商品</a
                    >
                  </li>
                  <li><a href="shop.html?categoryId=1">寵物飼料</a></li>
                  <li><a href="shop.html?categoryId=2">寵物罐頭</a></li>
                  <li><a href="shop.html?categoryId=3">寵物零食</a></li>
                  <li><a href="shop.html?categoryId=4">寵物用品</a></li>
                  <li><a href="shop.html?categoryId=5">寵物玩具</a></li>
                </ul>
              </div>

              <!-- 寵物種類 -->
              <div class="sidebar_section">
                <div class="sidebar_title">
                  <h5>寵物種類</h5>
                </div>
                <ul class="product_sorting">
                  <li>
                    <span id="animal-type-span">寵物種類</span>
                    <i class="fa fa-angle-down"></i>
                    <ul id="animal-type-list">
                      <li data-animalTypeId="1"><span>狗</span></li>
                      <li data-animalTypeId="2"><span>貓</span></li>
                      <li data-animalTypeId="3"><span>兔子</span></li>
                      <li data-animalTypeId="4"><span>鼠</span></li>
                    </ul>
                  </li>
                </ul>
              </div>

              <!-- Price Range Filtering -->
              <div class="sidebar_section">
                <div class="sidebar_title">
                  <h5>價格區間</h5>
                </div>
                <p>
                  <input
                    type="text"
                    id="amount"
                    readonly
                    style="border: 0; color: #f6931f; font-weight: bold" />
                </p>
                <div id="slider-range"></div>
                <div class="filter_button"><span>篩選</span></div>
              </div>
            </div>

            <!-- Main Content -->

            <div class="main_content">
              <!-- Products -->

              <div class="products_iso">
                <div class="row">
                  <div class="col">
                    <!-- Product Sorting -->

                    <div
                      class="product_sorting_container product_sorting_container_top">
                      <ul class="product_sorting">
                        <li>
                          <span class="type_sorting_text">默認排序</span>
                          <i class="fa fa-angle-down"></i>
                          <ul class="sorting_type">
                            <li
                              class="type_sorting_btn"
                              data-isotope-option='{ "sortBy": "original-order" }'>
                              <span>默認排序</span>
                            </li>
                            <li
                              class="type_sorting_btn"
                              data-isotope-option='{ "sortBy": "price" }'>
                              <span>價格</span>
                            </li>
                            <li
                              class="type_sorting_btn"
                              data-isotope-option='{ "sortBy": "name" }'>
                              <span>名稱</span>
                            </li>
                          </ul>
                        </li>
                        <!-- <li>
                          <span>Show</span>
                          <span class="num_sorting_text">6</span>
                          <i class="fa fa-angle-down"></i>
                          <ul class="sorting_num">
                            <li class="num_sorting_btn"><span>6</span></li>
                            <li class="num_sorting_btn"><span>12</span></li>
                            <li class="num_sorting_btn"><span>24</span></li>
                          </ul>
                        </li> -->
                      </ul>
                      <div class="pages d-flex flex-row align-items-center">
                        <div>
                          <ul class="product_sorting">
                            <li>
                              <span>功能選單</span>
                              <span class="num_sorting_text"></span>
                              <i class="fa fa-angle-down"></i>
                              <ul class="page_selection">
                                <li class="num_sorting_btn">
                                  <a href="/page/shop/shop-cart.html">購物車</a>
                                </li>
                                <li class="num_sorting_btn">
                                  <a href="/page/shop/shop-collection.html"
                                    >商品收藏</a
                                  >
                                </li>
                                <li class="num_sorting_btn">
                                  <a href="/page/shop/shop-orders.html"
                                    >查看訂單</a
                                  >
                                </li>
                              </ul>
                            </li>
                          </ul>
                        </div>
                        <!-- <div class="page_total"><span>of</span> 3</div>
                        <div id="next_page" class="page_next">
                          <a href="#"
                            ><i
                              class="fa fa-long-arrow-right"
                              aria-hidden="true"></i
                          ></a>
                        </div> -->
                      </div>
                    </div>

                    <!-- Product Grid -->

                    <div class="product-grid"></div>

                    <!-- <div
                      class="product_sorting_container product_sorting_container_bottom clearfix">
                      <ul class="product_sorting">
                        <li>
                          <span>Show:</span>
                          <span class="num_sorting_text">04</span>
                          <i class="fa fa-angle-down"></i>
                          <ul class="sorting_num">
                            <li class="num_sorting_btn"><span>01</span></li>
                            <li class="num_sorting_btn"><span>02</span></li>
                            <li class="num_sorting_btn"><span>03</span></li>
                            <li class="num_sorting_btn"><span>04</span></li>
                          </ul>
                        </li>
                      </ul>
                      <span class="showing_results"
                        >Showing 1–3 of 12 results</span
                      >
                      <div class="pages d-flex flex-row align-items-center">
                        <div class="page_current">
                          <span>1</span>
                          <ul class="page_selection">
                            <li><a href="#">1</a></li>
                            <li><a href="#">2</a></li>
                            <li><a href="#">3</a></li>
                          </ul>
                        </div>
                        <div class="page_total"><span>of</span> 3</div>
                        <div id="next_page_1" class="page_next">
                          <a href="#"
                            ><i
                              class="fa fa-long-arrow-right"
                              aria-hidden="true"></i
                          ></a>
                        </div>
                      </div>
                    </div> -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Benefit -->

      <div class="benefit">
        <div class="container">
          <div class="row benefit_row">
            <div class="col-lg-3 benefit_col">
              <div class="benefit_item d-flex flex-row align-items-center">
                <div class="benefit_icon">
                  <i class="fa fa-truck" aria-hidden="true"></i>
                </div>
                <div class="benefit_content">
                  <h6>free shipping</h6>
                  <p>Suffered Alteration in Some Form</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 benefit_col">
              <div class="benefit_item d-flex flex-row align-items-center">
                <div class="benefit_icon">
                  <i class="fa fa-money" aria-hidden="true"></i>
                </div>
                <div class="benefit_content">
                  <h6>cach on delivery</h6>
                  <p>The Internet Tend To Repeat</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 benefit_col">
              <div class="benefit_item d-flex flex-row align-items-center">
                <div class="benefit_icon">
                  <i class="fa fa-undo" aria-hidden="true"></i>
                </div>
                <div class="benefit_content">
                  <h6>45 days return</h6>
                  <p>Making it Look Like Readable</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 benefit_col">
              <div class="benefit_item d-flex flex-row align-items-center">
                <div class="benefit_icon">
                  <i class="fa fa-clock-o" aria-hidden="true"></i>
                </div>
                <div class="benefit_content">
                  <h6>opening all week</h6>
                  <p>8AM - 09PM</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="row my-5"></div>

      <footer class="bg-yellow">
        <div class="row">
          <div class="col-lg-5">
            <div
              class="footer_nav_container d-flex flex-sm-row flex-column align-items-center justify-content-lg-start justify-content-center text-center">
              <div class="container">
                <ul class="footer_nav">
                  <li><a href="#">討論區</a></li>
                  <li><a href="#">FAQs</a></li>
                  <li><a href="./contact.html">聯絡我們</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div
              class="footer_social d-flex flex-row align-items-center justify-content-lg-end justify-content-center">
              <ul>
                <li>
                  <a href="#"
                    ><i class="fa fa-facebook" aria-hidden="true"></i
                  ></a>
                </li>
                <li>
                  <a href="#"
                    ><i class="fa fa-twitter" aria-hidden="true"></i
                  ></a>
                </li>
                <li>
                  <a href="#"
                    ><i class="fa fa-instagram" aria-hidden="true"></i
                  ></a>
                </li>
                <li>
                  <a href="#"><i class="fa fa-skype" aria-hidden="true"></i></a>
                </li>
                <li>
                  <a href="#"
                    ><i class="fa fa-pinterest" aria-hidden="true"></i
                  ></a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12 text-center">
            <div class="footer_nav_container">
              <div class="container">
                <div class="cr">
                  ©2022 All Rights Reserverd. Made with
                  <i class="fa fa-heart-o" aria-hidden="true"></i> by
                  <a href="#">Colorlib</a> &amp; distributed by
                  <a href="../frontEnd/front_page.html"
                    >Tibame TGA-105 第四組</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../styles/bootstrap4/popper.js"></script>
    <script src="../../styles/bootstrap4/bootstrap.min.js"></script>

    <script src="../../plugins/Isotope/isotope.pkgd.min.js"></script>
    <script src="../../plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
    <script src="../../plugins/easing/easing.js"></script>
    <script src="../../plugins/jquery-ui-1.12.1.custom/jquery-ui.js"></script>
    <script src="../../js/categories_custom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.0/dist/js.cookie.min.js"></script>

    <script>
      // 取得urlParams
      const urlParams = new URLSearchParams(window.location.search);
      const categoryId = urlParams.get("categoryId");
      const animalTypeId = urlParams.get("animalTypeId");
      let memberId = Cookies.get("memberId");

      function initIsotopeFiltering() {
        var sortTypes = $(".type_sorting_btn");
        var sortNums = $(".num_sorting_btn");
        var sortTypesSelected = $(
          ".sorting_type .item_sorting_btn is-checked span"
        );
        var filterButton = $(".filter_button");

        if ($(".product-grid").length) {
          $(".product-grid").isotope({
            itemSelector: ".product-item",
            getSortData: {
              price: function (itemElement) {
                var priceEle = $(itemElement)
                  .find(".product_price")
                  .text()
                  .replace("$", "");
                return parseFloat(priceEle);
              },
              name: ".product_name",
            },
            animationOptions: {
              duration: 750,
              easing: "linear",
              queue: false,
            },
          });

          // Short based on the value from the sorting_type dropdown
          sortTypes.each(function () {
            $(this).on("click", function () {
              $(".type_sorting_text").text($(this).text());
              var option = $(this).attr("data-isotope-option");
              option = JSON.parse(option);
              $(".product-grid").isotope(option);
            });
          });

          // Show only a selected number of items
          sortNums.each(function () {
            $(this).on("click", function () {
              var numSortingText = $(this).text();
              var numFilter = ":nth-child(-n+" + numSortingText + ")";
              $(".num_sorting_text").text($(this).text());
              $(".product-grid").isotope({ filter: numFilter });
            });
          });

          // Filter based on the price range slider
          filterButton.on("click", function () {
            $(".product-grid").isotope({
              filter: function () {
                var priceRange = $("#amount").val();
                var priceMin = parseFloat(
                  priceRange.split("-")[0].replace("$", "")
                );
                var priceMax = parseFloat(
                  priceRange.split("-")[1].replace("$", "")
                );
                var itemPrice = $(this)
                  .find(".product_price")
                  .clone()
                  .children()
                  .remove()
                  .end()
                  .text()
                  .replace("$", "");

                return itemPrice > priceMin && itemPrice < priceMax;
              },
              animationOptions: {
                duration: 750,
                easing: "linear",
                queue: false,
              },
            });
          });
        }
      }

      function init() {
        const angleDoubleRight =
          '<span><i class="fa fa-angle-double-right" aria-hidden="true"></i></span>';

        if (categoryId) {
          $(".sidebar_categories li").removeClass("active");
          $(".sidebar_categories li a span").remove();
          $(
            ".sidebar_categories li a[href='shop.html?categoryId=" +
              categoryId +
              "']"
          )
            .parent()
            .addClass("active")
            .children("a")
            .prepend(angleDoubleRight);
        }

        if (animalTypeId) {
          let petType = $(
            "#animal-type-list li[data-animalTypeId='" +
              animalTypeId +
              "'] span"
          ).text();
          $("#animal-type-span").text(petType);
        }

        $.ajax({
          url: "/products/spec",
          type: "GET",
          data: {
            productStatus: 1,
            animalTypeId: animalTypeId,
            categoryId: categoryId,
          },
          dataType: "json",
          success: function (data) {
            let list_html = "";
            $.each(data, function (i, item) {
              let img = "";
              $.each(item.productImages, function (i, unit) {
                if (unit.productImageType == 0 && unit.productImage != null) {
                  img = unit.productImage;
                }
              });
              // 取得今天的日期
              const today = new Date();
              // 計算兩天前的日期
              const twoDaysAgo = new Date();
              twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
              // 取得商品的創建日期
              const productCreateDate = new Date(item.productCreateDate);
              // 商品的創建日期在兩天之內
              let newicon = "";
              if (productCreateDate >= twoDaysAgo) {
                newicon = `<div class="product_bubble product_bubble_left product_bubble_green d-flex flex-column align-items-center"><span>new</span></div>`;
              }

              list_html += `
                                    <div class="product-item men">
                                      <div class="product product_filter">
                                        <div class="product_image image-container">
                                          <img src="/productimages/${img}" class="image-container"/>
                                        </div>
                                        <div class="favorite" data-productId="${item.productId}"></div>
                                        ${newicon}
                                        <div class="product_info">
                                          <h6 class="product_name">
                                            <a href="shop-product.html?id=${item.productId}"
                                              >${item.productName}</a
                                            >
                                          </h6>
                                          <div class="product_price">$${item.productPrice}</div>
                                        </div>
                                      </div>
                                      <div class="red_button add_to_cart_button">
                                        <a href="" data-productId="${item.productId}">加入購物車</a>
                                      </div>
                                    </div>`;
            });
            $(".product-grid").html(list_html);
            initIsotopeFiltering();
          },
          error: function (xhr, textStatus, errorThrown) {
            console.log("error");
            console.log(xhr);
          },
        });
      }

      $(function () {
        init();

        $(".product-grid").on(
          "click",
          ".add_to_cart_button a",
          function (event) {
            event.preventDefault();
            if (!memberId) {
              alert("請先登入在進行操作");
              return;
            }
            let productId = $(this).data("productid");
            let cartData = {
              memberId: memberId,
              product: {
                productId: productId,
              },
              productNumber: 1,
            };
            // 商品添加到購物車
            $.ajax({
              url: "/productcarts",
              type: "POST",
              contentType: "application/json",
              data: JSON.stringify(cartData),
              success: function (data) {
                if (data) {
                  alert("商品成功加入購物車!");
                } else {
                  alert("商品已存在購物車!");
                }
              },
              error: function (xhr, textStatus, errorThrown) {
                console.log("error");
                console.log(xhr);
              },
            });
          }
        );

        $(".product-grid").on("click", ".favorite", function () {
          if (!memberId) {
            alert("請先登入在進行操作");
            return;
          }

          let productId = $(this).data("productid");
          let favoriteData = {
            memberId: memberId,
            product: {
              productId: productId,
            },
          };
          // 商品加入收藏
          $.ajax({
            url: "/productcollections",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(favoriteData),
            success: function (data) {
              if (data) {
                alert("商品成功加入收藏!");
              } else {
                alert("商品已移除收藏!");
              }
            },
            error: function (xhr, textStatus, errorThrown) {
              console.log("error");
              console.log(xhr);
            },
          });
        });

        $("#animal-type-list li").click(function () {
          var animalTypeId = $(this).data("animaltypeid");
          categoryId == null ? (category = "") : (category = categoryId);
          window.location.href =
            "shop.html?categoryId=" +
            category +
            "&animalTypeId=" +
            animalTypeId;
        });
      });
    </script>
  </body>
</html>
